{{define "show_ajax_errors"}}
<script>
    // prevent close button from removing alert div from the DOM so we can reuse it.
    // Unfortunately, this seems to also disable fade in/out from working.
    // https://stackoverflow.com/questions/8965018/dynamically-creating-bootstrap-css-alert-messages
    $('.alert .close').on('click', function(e) {
        $(this).parent().hide();
    });

    var errorSpan = $('#ajax-error');
    var errorsDiv = $(errorSpan).closest('div');

    function showAjaxErrors(xhr, status, error) {
        console.log('error, xhr: ' + JSON.stringify(xhr) + ', status: ' + JSON.stringify(status) + ', error: ' + JSON.stringify(error));

        var errorMap = {};

        // https://stackoverflow.com/a/28404728/93995
        if (xhr.readyState === 4) {
            // HTTP error (can be checked by XMLHttpRequest.status and XMLHttpRequest.statusText)
            errorMap = xhr.responseJSON;
        }
        else if (xhr.readyState === 0) {
            // Network error (i.e. connection refused, access denied due to CORS, etc.)
            errorMap = {"error": "error contacting restic server"};
        }
        else {
            // something weird is happening
            errorMap = {"error": "error contacting restic server"};
        }

        clearAjaxErrors();

        $.each(errorMap, function (key, value) {
            $(errorSpan).append(value);
        });

        $(errorsDiv).show();
    }

    // clear previous errors, if any
    function clearAjaxErrors() {
        $(errorSpan).empty();
        $(errorsDiv).hide();
    }

</script>
{{end}}
